generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Signalement {
  id                    String            @id @default(cuid())
  codeBarres            String
  quantite              Int
  datePeremption        DateTime
  commentaire           String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  status                SignalementStatus @default(EN_ATTENTE)
  probabiliteEcoulement Decimal?          @db.Decimal(5, 2)
  urgenceCalculee       String?

  @@index([createdAt(sort: Desc)])
  @@index([status])
  @@index([urgenceCalculee])
  @@index([probabiliteEcoulement(sort: Desc)])
  @@index([codeBarres])
  @@index([urgenceCalculee, status])
  @@index([urgenceCalculee, status], map: "signalements_urgence_status_idx")
  @@map("signalements")
}

model ProductRotation {
  id                String   @id @default(cuid())
  ean13             String   @unique
  rotationMensuelle Decimal  @db.Decimal(8, 2)
  derniereMAJ       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  prixAchatUnitaire Decimal? @db.Decimal(8, 2)

  @@index([derniereMAJ(sort: Desc)])
  @@index([prixAchatUnitaire(sort: Desc)])
  @@map("product_rotations")
}

model Inventaire {
  id          String           @id @default(cuid())
  nom         String
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  finishedAt  DateTime?
  status      InventaireStatus @default(EN_COURS)
  items       InventaireItem[]

  @@index([status, createdAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@map("inventaires")
}

model InventaireItem {
  id           String     @id @default(cuid())
  ean13        String
  quantite     Int
  ordre        Int
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  inventaireId String
  inventaire   Inventaire @relation(fields: [inventaireId], references: [id], onDelete: Cascade)

  @@index([inventaireId, ordre(sort: Desc)])
  @@index([inventaireId, ean13])
  @@index([ean13])
  @@map("inventaire_items")
}

enum InventaireStatus {
  EN_COURS
  TERMINE
  ARCHIVE
}

enum SignalementStatus {
  EN_ATTENTE
  EN_COURS
  A_DESTOCKER
  DETRUIT
  A_VERIFIER
  ECOULEMENT
}
