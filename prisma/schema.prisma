// prisma/schema.prisma - Version compl√®te avec rotation
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SignalementStatus {
  EN_ATTENTE
  EN_COURS
  A_DESTOCKER
  A_VERIFIER
  DETRUIT
}

model Signalement {
  id                   String            @id @default(cuid())
  codeBarres          String
  quantite            Int
  datePeremption      DateTime
  commentaire         String?
  status              SignalementStatus @default(EN_ATTENTE)
  
  // Nouveaux champs rotation
  urgenceCalculee     String?           // 'low', 'medium', 'high', 'critical'
  probabiliteEcoulement Decimal?        @db.Decimal(5,2)
  
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  @@index([createdAt(sort: Desc)])
  @@index([status])
  @@index([urgenceCalculee])
  @@index([probabiliteEcoulement(sort: Desc)])
  @@index([codeBarres]) // Pour lookup rotation
  @@index([urgenceCalculee, status])
  @@map("signalements")
}

model ProductRotation {
  id                String   @id @default(cuid())
  ean13            String   @unique
  rotationMensuelle Decimal  @db.Decimal(8,2)
  derniereMAJ      DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([derniereMAJ(sort: Desc)])
  @@map("product_rotations")
}